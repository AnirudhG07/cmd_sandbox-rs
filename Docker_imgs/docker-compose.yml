version: '3.8'

services:
  # Universal sandbox container (auto-detects architecture)
  sandbox:
    build:
      context: ..
      dockerfile: Docker_imgs/Dockerfile
    image: cmd-sandbox-rs:latest
    container_name: cmd-sandbox
    privileged: true
    cap_add:
      - SYS_ADMIN
      - NET_ADMIN
      - BPF
    security_opt:
      - apparmor:unconfined
    volumes:
      - /sys/kernel/security:/sys/kernel/security:ro
      - /sys/fs/cgroup:/sys/fs/cgroup:rw
      - /lib/modules:/lib/modules:ro
    networks:
      - sandbox-net
    stdin_open: true
    tty: true
    command: /bin/bash

networks:
  sandbox-net:
    driver: bridge
